basePath: /api
definitions:
  handlers.ErrorResponse:
    properties:
      error:
        type: string
    type: object
  handlers.MessageResponse:
    properties:
      message:
        type: string
    type: object
  handlers.PasswordUpdateRequest:
    properties:
      password:
        type: string
    type: object
  handlers.UserCreateRequest:
    properties:
      can_create:
        type: boolean
      can_delete:
        type: boolean
      can_edit:
        type: boolean
      can_view:
        type: boolean
      is_admin:
        type: boolean
      password:
        type: string
      username:
        type: string
    type: object
  handlers.UserUpdateRequest:
    properties:
      can_create:
        type: boolean
      can_delete:
        type: boolean
      can_edit:
        type: boolean
      can_view:
        type: boolean
      is_admin:
        type: boolean
      password:
        type: string
    type: object
  models.CustomField:
    properties:
      name:
        type: string
      type:
        description: 'Supported types: TEXT, INTEGER, REAL, BOOLEAN'
        type: string
    type: object
  models.Database:
    properties:
      config:
        type: object
      content_type:
        type: string
      custom_fields:
        items:
          $ref: '#/definitions/models.CustomField'
        type: array
      housekeeping:
        $ref: '#/definitions/models.Housekeeping'
      last_hk_run:
        type: string
      name:
        type: string
      stats:
        $ref: '#/definitions/models.Stats'
    type: object
  models.DatabaseCreatePayload:
    properties:
      config:
        additionalProperties: true
        type: object
      content_type:
        type: string
      custom_fields:
        items:
          $ref: '#/definitions/models.CustomField'
        type: array
      housekeeping:
        $ref: '#/definitions/models.Housekeeping'
      name:
        type: string
    type: object
  models.DatabaseUpdatePayload:
    properties:
      config:
        additionalProperties: true
        type: object
      housekeeping:
        $ref: '#/definitions/models.Housekeeping'
    type: object
  models.Entry:
    additionalProperties: true
    type: object
  models.Housekeeping:
    properties:
      disk_space:
        type: string
      interval:
        type: string
      max_age:
        type: string
    type: object
  models.HousekeepingReport:
    properties:
      database_name:
        type: string
      entries_deleted:
        type: integer
      message:
        type: string
      space_freed_bytes:
        type: integer
    type: object
  models.Info:
    properties:
      ffmpeg:
        type: boolean
      ffprobe:
        type: boolean
      service_name:
        type: string
      uptime_since:
        type: string
      version:
        type: string
    type: object
  models.PartialEntryResponse:
    properties:
      custom_fields:
        allOf:
        - $ref: '#/definitions/models.Entry'
        description: Only fields provided by user
      database_name:
        type: string
      id:
        type: integer
      status:
        description: Will be "processing"
        type: string
      timestamp:
        type: integer
    type: object
  models.SearchFilter:
    properties:
      conditions:
        items:
          $ref: '#/definitions/models.SearchFilter'
        type: array
      field:
        description: For single conditions ("=", ">", "<", etc.)
        type: string
      operator:
        description: For logical grouping ("and", "or")
        type: string
      value: {}
    type: object
  models.SearchPagination:
    properties:
      limit:
        description: Pointer to check if it was provided
        type: integer
      offset:
        type: integer
    type: object
  models.SearchRequest:
    properties:
      filter:
        allOf:
        - $ref: '#/definitions/models.SearchFilter'
        description: Pointer so it can be omitted
      pagination:
        $ref: '#/definitions/models.SearchPagination'
      sort:
        allOf:
        - $ref: '#/definitions/models.SearchSort'
        description: Pointer so it can be omitted
    type: object
  models.SearchSort:
    properties:
      direction:
        description: '"asc", "desc"'
        type: string
      field:
        type: string
    type: object
  models.Stats:
    properties:
      entry_count:
        type: integer
      total_disk_space_bytes:
        type: integer
    type: object
  models.User:
    properties:
      can_create:
        type: boolean
      can_delete:
        type: boolean
      can_edit:
        type: boolean
      can_view:
        type: boolean
      id:
        type: integer
      is_admin:
        type: boolean
      username:
        type: string
    type: object
info:
  contact:
    email: denglerchr@gmail.com
    name: Christian Dengler
    url: https://www.swcd.lu
  description: This is a sample server for a file store.
  title: SWCD MediaHub-API
  version: 1.0.0
paths:
  /database:
    delete:
      description: Deletes a database, its entry table, and all of its associated
        entries and metadata.
      parameters:
      - description: Database Name
        in: query
        name: name
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Success message
          schema:
            $ref: '#/definitions/handlers.MessageResponse'
        "400":
          description: Missing name parameter or invalid name
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "404":
          description: Database not found
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "500":
          description: Failed to delete database record or folder
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
      security:
      - BasicAuth: []
      summary: Delete a database
      tags:
      - database
    get:
      description: Retrieves details, custom fields, and statistics for a specific
        database.
      parameters:
      - description: Database Name
        in: query
        name: name
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.Database'
        "400":
          description: Missing name parameter
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "404":
          description: Database not found
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "500":
          description: Failed to calculate stats
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
      security:
      - BasicAuth: []
      summary: Get database details
      tags:
      - database
    post:
      consumes:
      - application/json
      description: Creates a new database with custom fields and a dedicated entry
        table.
      parameters:
      - description: Database Metadata
        in: body
        name: database
        required: true
        schema:
          $ref: '#/definitions/models.DatabaseCreatePayload'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/models.Database'
        "400":
          description: Invalid request payload or missing name
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "409":
          description: Database name already in use
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "500":
          description: Failed to create database or storage folder
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
      security:
      - BasicAuth: []
      summary: Create a new database
      tags:
      - database
    put:
      consumes:
      - application/json
      description: Updates the housekeeping rules for a specific database.
      parameters:
      - description: Database Name
        in: query
        name: name
        required: true
        type: string
      - description: Housekeeping Rules or Config flag
        in: body
        name: housekeeping
        required: true
        schema:
          $ref: '#/definitions/models.DatabaseUpdatePayload'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.Database'
        "400":
          description: Invalid request payload or missing name
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "404":
          description: Database not found
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "500":
          description: Failed to update database
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
      security:
      - BasicAuth: []
      summary: Update database housekeeping rules
      tags:
      - database
  /database/entries:
    get:
      description: Retrieves a paginated list of entries from a specific database.
        Only supports time-based filters.
      parameters:
      - description: Database Name
        in: query
        name: name
        required: true
        type: string
      - description: Number of entries to return (default 30)
        in: query
        name: limit
        type: integer
      - description: Offset for pagination (default 0)
        in: query
        name: offset
        type: integer
      - description: Sort order ('asc' or 'desc', default 'desc')
        in: query
        name: order
        type: string
      - description: Start timestamp (RFC3339 or Unix seconds)
        in: query
        name: tstart
        type: string
      - description: End timestamp (RFC3339 or Unix seconds)
        in: query
        name: tend
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Returns an empty array if no entries match
          schema:
            items:
              $ref: '#/definitions/models.Entry'
            type: array
        "400":
          description: Missing name parameter
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "404":
          description: Database not found
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "500":
          description: Failed to retrieve entries
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
      security:
      - BasicAuth: []
      summary: Get entries from a database (basic)
      tags:
      - database
  /database/entries/search:
    post:
      consumes:
      - application/json
      description: Retrieves a paginated list of entries matching complex filter criteria.
      parameters:
      - description: Database Name
        in: query
        name: name
        required: true
        type: string
      - description: JSON search query
        in: body
        name: search
        required: true
        schema:
          $ref: '#/definitions/models.SearchRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Returns an empty array if no entries match
          schema:
            items:
              $ref: '#/definitions/models.Entry'
            type: array
        "400":
          description: Missing name, invalid JSON, missing limit, or invalid filter/sort
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "404":
          description: Database not found
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "500":
          description: Failed to retrieve entries
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
      security:
      - BasicAuth: []
      summary: Search for entries in a database (complex)
      tags:
      - database
  /database/housekeeping:
    post:
      description: Manually triggers the housekeeping task for a specific database.
      parameters:
      - description: Database Name
        in: query
        name: name
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.HousekeepingReport'
        "400":
          description: Missing name parameter
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "404":
          description: Database not found
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "500":
          description: Housekeeping failed
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
      security:
      - BasicAuth: []
      summary: Trigger housekeeping for a database
      tags:
      - database
  /databases:
    get:
      description: Retrieves a list of all available databases and their statistics.
      produces:
      - application/json
      responses:
        "200":
          description: Returns an empty array if no databases exist
          schema:
            items:
              $ref: '#/definitions/models.Database'
            type: array
        "500":
          description: Failed to retrieve databases
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
      security:
      - BasicAuth: []
      summary: List all databases
      tags:
      - database
  /entry:
    delete:
      description: Deletes an entry file from disk and its metadata from the database.
      parameters:
      - description: Database Name
        in: query
        name: database_name
        required: true
        type: string
      - description: Entry ID
        in: query
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Success message
          schema:
            $ref: '#/definitions/handlers.MessageResponse'
        "400":
          description: Invalid request
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "404":
          description: Database or entry not found
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
      security:
      - BasicAuth: []
      summary: Delete an entry
      tags:
      - entry
    patch:
      consumes:
      - application/json
      description: Updates an entry's mutable metadata, including custom fields and
        the 'filename'.
      parameters:
      - description: Database Name
        in: query
        name: database_name
        required: true
        type: string
      - description: Entry ID
        in: query
        name: id
        required: true
        type: integer
      - description: JSON object with fields to update
        in: body
        name: updates
        required: true
        schema:
          $ref: '#/definitions/models.Entry'
      produces:
      - application/json
      responses:
        "200":
          description: The full, updated entry metadata object
          schema:
            $ref: '#/definitions/models.Entry'
        "400":
          description: Invalid request
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "404":
          description: Database or entry not found
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
      security:
      - BasicAuth: []
      summary: Update entry metadata
      tags:
      - entry
    post:
      consumes:
      - multipart/form-data
      description: |-
        Uploads a new entry to a specified database using multipart/form-data. The metadata part should be a JSON object containing the entry's timestamp, and any custom fields.
        The 'file' part's 'filename' in the Content-Disposition header will be extracted and saved.

        This endpoint uses a hybrid model:
        - **Small files (<= 8MB):** Processed synchronously. Returns `201 Created` with the full entry metadata.
        - **Large files (> 8MB):** Processed asynchronously. Returns `202 Accepted` with a partial response. The client should poll `GET /api/entry/meta` until the `status` field is 'ready'.
      parameters:
      - description: Database Name
        in: query
        name: database_name
        required: true
        type: string
      - description: JSON metadata for the entry (including custom fields)
        in: formData
        name: metadata
        required: true
        type: string
      - description: Entry file
        in: formData
        name: file
        required: true
        type: file
      produces:
      - application/json
      responses:
        "201":
          description: For small files (synchronous processing)
          schema:
            $ref: '#/definitions/models.Entry'
        "202":
          description: For large files (asynchronous processing)
          schema:
            $ref: '#/definitions/models.PartialEntryResponse'
        "400":
          description: Invalid request
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "404":
          description: Database not found
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "415":
          description: Unsupported entry format
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
      security:
      - BasicAuth: []
      summary: Upload an entry
      tags:
      - entry
  /entry/file:
    get:
      description: Retrieves a raw entry file.
      parameters:
      - description: Database Name
        in: query
        name: database_name
        required: true
        type: string
      - description: Entry ID
        in: query
        name: id
        required: true
        type: integer
      produces:
      - application/octet-stream
      responses:
        "200":
          description: The raw file data
          schema:
            type: file
        "400":
          description: Invalid request
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "404":
          description: Database or entry not found
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
      security:
      - BasicAuth: []
      summary: Get an entry file
      tags:
      - entry
  /entry/meta:
    get:
      description: Retrieves all metadata for a single entry, including custom fields.
      parameters:
      - description: Database Name
        in: query
        name: database_name
        required: true
        type: string
      - description: Entry ID
        in: query
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: The full entry metadata object
          schema:
            $ref: '#/definitions/models.Entry'
        "400":
          description: Invalid request
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "404":
          description: Database or entry not found
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
      security:
      - BasicAuth: []
      summary: Get entry metadata
      tags:
      - entry
  /entry/preview:
    get:
      description: Retrieves a 200x200 JPEG preview of an entry.
      parameters:
      - description: Database Name
        in: query
        name: database_name
        required: true
        type: string
      - description: Entry ID
        in: query
        name: id
        required: true
        type: integer
      produces:
      - image/jpeg
      responses:
        "200":
          description: The JPEG preview image
          schema:
            type: file
        "400":
          description: Invalid request
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "404":
          description: Database or entry not found
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "500":
          description: Internal server error
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
      security:
      - BasicAuth: []
      summary: Get an entry preview
      tags:
      - entry
  /info:
    get:
      description: Retrieves general information about the software, i.e., the service
        name, software version, uptime, and ffmpeg availability. This is a public
        endpoint.
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.Info'
      summary: Get service information
      tags:
      - Info
  /me:
    get:
      description: Get the currently authenticated user's details.
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.User'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
      security:
      - BasicAuth: []
      summary: Get current user
      tags:
      - Users
    patch:
      consumes:
      - application/json
      description: Allows a user to change their own password.
      parameters:
      - description: Password update request
        in: body
        name: password
        required: true
        schema:
          $ref: '#/definitions/handlers.PasswordUpdateRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/handlers.MessageResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
      security:
      - BasicAuth: []
      summary: Update current user's password
      tags:
      - Users
  /user:
    delete:
      description: Deletes a user account.
      parameters:
      - description: User ID
        in: query
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/handlers.MessageResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
      security:
      - BasicAuth: []
      summary: Delete a user
      tags:
      - Admin
    patch:
      consumes:
      - application/json
      description: Updates an existing user's roles or password.
      parameters:
      - description: User ID
        in: query
        name: id
        required: true
        type: integer
      - description: User update request
        in: body
        name: user
        required: true
        schema:
          $ref: '#/definitions/handlers.UserUpdateRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.User'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
      security:
      - BasicAuth: []
      summary: Update a user's roles or password
      tags:
      - Admin
    post:
      consumes:
      - application/json
      description: Creates a new user account.
      parameters:
      - description: User creation request
        in: body
        name: user
        required: true
        schema:
          $ref: '#/definitions/handlers.UserCreateRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/models.User'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
      security:
      - BasicAuth: []
      summary: Create a new user
      tags:
      - Admin
  /users:
    get:
      description: Retrieves a list of all users in the system.
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/models.User'
            type: array
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/handlers.ErrorResponse'
      security:
      - BasicAuth: []
      summary: Get all users
      tags:
      - Admin
schemes:
- http
securityDefinitions:
  BasicAuth:
    type: basic
swagger: "2.0"
