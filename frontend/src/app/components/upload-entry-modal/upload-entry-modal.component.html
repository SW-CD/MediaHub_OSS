<app-modal [modalId]="'uploadEntryModal'" [modalTitle]="'Upload Entry to ' + (currentDatabase?.name || '')">
  
  <div *ngIf="currentDatabase && uploadForm"
       appFileDragDrop
       (fileDropped)="handleFile($event)">
       
    <form [formGroup]="uploadForm" (ngSubmit)="onSubmit()">

      <div class="form-group">
        <label for="file" class="form-label">File</label>
        
        <div class="form-file-input">
          <input 
            id="file" 
            type="file" 
            (change)="onFileSelected($event)" 
            [accept]="fileAcceptString"
            #fileInput>
          
          <label for="file" class="file-label">{{ selectedFileName || 'No file chosen' }}</label>
          
          <button type="button" class="file-browse-btn" (click)="fileInput.click()">Browse...</button>
        </div>
        
        <div *ngIf="uploadForm.get('file')?.invalid && uploadForm.get('file')?.touched" class="form-error">
          A file is required.
        </div>
      </div>

      <div class="form-group">
        <label for="timestamp" class="form-label">Timestamp</label>
        <input id="timestamp" type="datetime-local" formControlName="timestamp" class="form-control">
      </div>

      <div *ngIf="currentDatabase.custom_fields.length > 0" class="custom-fields-section">
        <h4>Custom Metadata</h4>
        <div class="form-grid">
          
          <div *ngFor="let field of currentDatabase.custom_fields" class="form-group">
            <ng-container [ngSwitch]="field.type">

              <ng-container *ngSwitchCase="'BOOLEAN'">
                <label [for]="field.name" class="form-label">{{ field.name }} (BOOLEAN)</label>
                <div class="bool-field-container">
                  <label class="toggle-switch">
                    <input type="checkbox" [id]="field.name" [formControlName]="field.name">
                    <span class="toggle-slider"></span>
                  </label>
                  <span class="bool-field-value">
                    {{ uploadForm.get(field.name)?.value ? 'True' : 'False' }}
                  </span>
                </div>
              </ng-container>

              <ng-container *ngSwitchDefault>
                <label [for]="field.name" class="form-label">{{ field.name }} ({{ field.type }})</label>
                
                <ng-container [ngSwitch]="field.type">
                  <input *ngSwitchCase="'INTEGER'"
                         [id]="field.name"
                         type="number"
                         step="1"
                         [formControlName]="field.name"
                         class="form-control">
                  
                  <input *ngSwitchCase="'REAL'"
                         [id]="field.name"
                         type="number"
                         step="any"
                         [formControlName]="field.name"
                         class="form-control">
                  
                  <input *ngSwitchDefault
                         [id]="field.name"
                         type="text"
                         [formControlName]="field.name"
                         class="form-control">
                </ng-container>
              </ng-container>

            </ng-container>
          </div>

        </div>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancel</button>
        <button type="submit" class="btn btn-primary" [disabled]="uploadForm.invalid || isLoading">
          {{ isLoading ? 'Uploading...' : 'Upload' }}
        </button>
      </div>

    </form>
  </div>

  <div *ngIf="!currentDatabase">
    <p>Please select a database first before uploading an entry.</p>
  </div>
</app-modal>