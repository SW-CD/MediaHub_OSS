<!-- frontend/src/app/components/sidebar/sidebar.component.html -->

<!-- 
  Add a 'collapsed' class to the container when isCollapsed is true.
  This will trigger the CSS changes.
-->
<div class="sidebar-container" 
     [class.collapsed]="isCollapsed"
     *ngIf="currentUser$ | async as user">
  
  <!-- Header with Logo -->
  <header class="sidebar-header">
    <!-- NEW: Wrapper for logo and version -->
    <div class="logo-area">
      <div class="logo-container">
        <img src="assets/logo.svg" alt="App Logo" class="logo-icon">
        <!-- Hide text when collapsed -->
        <h1 class="logo-text" *ngIf="!isCollapsed">MediaHub</h1>
      </div>
      <!-- Display app version -->
      <div class="app-version" *ngIf="!isCollapsed && (appInfo$ | async) as info">
          <a 
            href="https://www.swcd.lu" 
            target="_blank" 
            rel="noopener noreferrer" 
            style="color: inherit; text-decoration: none;"
          >by SWCD</a> | {{ info.version }}
        </div>
    </div>
  </header>

  <!-- Databases Section -->
  <div class="databases-section">
    <div class="section-header">
      <!-- Hide text when collapsed -->
      <h2 class="section-title" *ngIf="!isCollapsed">Databases</h2>
      <!-- Hide button when collapsed -->
      <button 
        *ngIf="user.can_create && !isCollapsed"
        class="create-db-btn" 
        (click)="openCreateDatabaseModal()" 
        title="Create New Database">
        +
      </button>
    </div>
    
    <ul class="db-list" *ngIf="databases$ | async as databases">
      <!-- Hide empty state text when collapsed -->
      <li *ngIf="databases.length === 0 && !isCollapsed" class="db-list-item-empty">
        No databases found.
      </li>

      <li *ngFor="let db of databases; trackBy: trackByDbName" 
          class="db-list-item"
          [class.active]="db.name === selectedDbName">
        <a [routerLink]="['/dashboard/db', db.name]" 
           class="db-link"
           [title]="isCollapsed ? db.name : ''">
            <!-- UPDATED: Use dynamic icon -->
            <img [src]="getIconForDb(db)" class="db-icon" alt="db-icon" />
            <!-- Hide text and settings icon when collapsed -->
            <span class="truncate flex-grow" *ngIf="!isCollapsed">{{ db.name }}</span>
            <span class="settings-icon flex-shrink-0" *ngIf="!isCollapsed" (click)="goToSettings($event, db.name)" title="Settings">
              <img src="assets/icons/settings-icon.svg" class="settings-icon-img" alt="settings-icon" />
            </span>
        </a>
      </li>
    </ul>

  </div>

  <!-- Footer Section -->
  <footer class="sidebar-footer">
    
    <!-- User Info: Hide when collapsed -->
    <div class="user-info" *ngIf="!isCollapsed">
      <div class="user-avatar">{{ user.username.charAt(0).toUpperCase() }}</div>
      <div class="user-details">
        <div class="username" title="{{user.username}}">{{ user.username }}</div>
        <div class="user-role">{{ user.is_admin ? 'Administrator' : 'User' }}</div>
      </div>
    </div>

    <!-- Navigation Links: Hide when collapsed -->
    <nav class="nav-links" *ngIf="!isCollapsed">
        <a *ngIf="user.is_admin" routerLink="/dashboard/admin/users" class="nav-link">
            <img src="assets/icons/admin-icon.svg" class="nav-link-icon" alt="admin-icon" />
            Admin Panel
        </a>
        <a (click)="openChangePasswordModal()" class="nav-link cursor-pointer">
            <img src="assets/icons/password-icon.svg" class="nav-link-icon" alt="password-icon" />
            Change Password
        </a>
        <a href="/swagger/index.html" target="_blank" class="nav-link">
            <img src="assets/icons/api-icon.svg" class="nav-link-icon" alt="api-icon" />
            API Docs
        </a>
    </nav>
    
    <!-- Logout Button: Hide text when collapsed -->
    <button (click)="logout()" class="logout-button" [title]="isCollapsed ? 'Logout' : ''">
      <img src="assets/icons/logout-icon.svg" alt="Logout" class="logout-icon">
      <span *ngIf="!isCollapsed">Logout</span>
    </button>
    
    <!-- 
      NEW: Sidebar Toggle Button 
      This button is always visible in the footer.
    -->
    <button (click)="onToggleSidebar()" class="sidebar-toggle-btn" [title]="isCollapsed ? 'Expand Sidebar' : 'Collapse Sidebar'">
      <svg *ngIf="!isCollapsed" xmlns="http://www.w3.org/2000/svg" width="1.5em" height="1.5em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="9" y1="3" x2="9" y2="21"></line></svg>
      <svg *ngIf="isCollapsed" xmlns="http://www.w3.org/2000/svg" width="1.5em" height="1.5em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="15" y1="3" x2="15" y2="21"></line></svg>
    </button>

  </footer>
</div>
