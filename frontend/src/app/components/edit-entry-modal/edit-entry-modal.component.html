<app-modal [modalId]="'editEntryModal'" [modalTitle]="'Edit Entry Metadata'">
  <div *ngIf="currentEntry && editForm && currentDatabase">
    <form [formGroup]="editForm" (ngSubmit)="onSubmit()">

      <div class="form-grid">
        <div class="form-group">
          <label for="edit-timestamp" class="form-label">Timestamp</label>
          <input id="edit-timestamp" type="datetime-local" formControlName="timestamp" class="form-control">
        </div>
        
        <div class="form-group">
          <label for="edit-filename" class="form-label">Filename</label>
          <input id="edit-filename" type="text" formControlName="filename" class="form-control">
        </div>

        <ng-container [ngSwitch]="currentDatabase.content_type">
          
          <ng-container *ngSwitchCase="'image'">
            <div class="form-group">
              <label for="edit-width" class="form-label">Width</label>
              <input id="edit-width" type="number" formControlName="width" class="form-control">
            </div>
            <div class="form-group">
              <label for="edit-height" class="form-label">Height</label>
              <input id="edit-height" type="number" formControlName="height" class="form-control">
            </div>
          </ng-container>

          <ng-container *ngSwitchCase="'audio'">
            <div class="form-group">
              <label for="edit-duration" class="form-label">Duration (sec)</label>
              <input id="edit-duration" type="number" step="any" formControlName="duration_sec" class="form-control">
            </div>
            <div class="form-group">
              <label for="edit-channels" class="form-label">Channels</label>
              <input id="edit-channels" type="number" step="1" formControlName="channels" class="form-control">
            </div>
          </ng-container>

        </ng-container>
      </div>

      <div *ngIf="currentDatabase.custom_fields.length > 0" class="custom-fields-section">
        <h4>Custom Metadata</h4>
        <div class="form-grid">
          
          <div *ngFor="let field of currentDatabase.custom_fields" class="form-group">
            
            <ng-container [ngSwitch]="field.type">

              <ng-container *ngSwitchCase="'BOOLEAN'">
                <label [for]="field.name" class="form-label">{{ field.name }} (BOOLEAN)</label>
                
                <div class="bool-field-container">
                  <label class="toggle-switch">
                    <input type="checkbox" [id]="field.name" [formControlName]="field.name">
                    <span class="toggle-slider"></span>
                  </label>
                  <span class="bool-field-value">
                    {{ editForm.get(field.name)?.value ? 'True' : 'False' }}
                  </span>
                </div>
              </ng-container>

              <ng-container *ngSwitchDefault>
                <label [for]="field.name" class="form-label">{{ field.name }} ({{ field.type }})</label>

                <ng-container [ngSwitch]="field.type">
                  <input *ngSwitchCase="'INTEGER'"
                         [id]="field.name"
                         type="number"
                         step="1"
                         [formControlName]="field.name"
                         class="form-control">
                  <input *ngSwitchCase="'REAL'"
                         [id]="field.name"
                         type="number"
                         step="any"
                         [formControlName]="field.name"
                         class="form-control">
                  <input *ngSwitchDefault
                         [id]="field.name"
                         type="text"
                         [formControlName]="field.name"
                         class="form-control">
                </ng-container>
              </ng-container>
            </ng-container>
          </div>
        </div>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancel</button>
        <button type="submit" class="btn btn-primary" [disabled]="editForm.invalid || isLoading">
          {{ isLoading ? 'Saving...' : 'Save Changes' }}
        </button>
      </div>

    </form>
  </div>

  <div *ngIf="!currentEntry || !editForm || !currentDatabase">
    <p>Loading entry metadata...</p>
  </div>
</app-modal>