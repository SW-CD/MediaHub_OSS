<app-modal [modalId]="'entryDetailModal'" [modalTitle]="'Entry Details'">
  <div class="detail-container" *ngIf="entryForMetadata; else loading">
    
    <div class="entry-preview">
      
      <div [ngSwitch]="entryForMetadata.mime_type | slice:0:5">
        
        <img *ngSwitchCase="'image'" 
             [src]="fileUrl" 
             class="preview-image"
             alt="Entry preview for ID {{ entryForMetadata.id }}" />

        <div *ngSwitchCase="'audio'" class="audio-preview-wrapper">
          <img [src]="previewUrl | secureImage | async" 
               class="audio-waveform" 
               alt="Waveform for {{ entryForMetadata.id }}" />
          <audio controls [src]="fileUrl" class="audio-controls"></audio>
        </div>

        <div *ngSwitchDefault class="generic-file-preview">
          <img src="assets/icons/file-icon.svg" class="file-icon" alt="File Icon" />
          <p>No preview available for {{ entryForMetadata.mime_type }}</p>
        </div>
      </div>

      <div *ngIf="isLoadingFile" class="loading-placeholder">
        Loading File...
      </div>
    </div>
    
    <div class="metadata-section">
      <h3>Metadata</h3>
      <table class="metadata-table">
        <tbody>
          <tr *ngFor="let key of metadataKeys">
            <th>{{ key }}</th>
            <td>{{ key === 'timestamp' ? (entryForMetadata[key] * 1000 | date:'yyyy.MM.dd HH:mm:ss') : entryForMetadata[key] }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="modal-actions">
      <a [href]="fileUrl" 
         [download]="entryForMetadata.filename || 'download'" 
         class="btn btn-secondary"
         [class.disabled]="isLoadingFile" 
         [style.pointer-events]="isLoadingFile ? 'none' : 'auto'">Download</a>
      <button type="button" class="btn btn-primary" (click)="closeModal()">Close</button>
    </div>

  </div>
  <ng-template #loading>
    <p *ngIf="!isLoadingFile">Loading entry details...</p>
  </ng-template>
</app-modal>